<!DOCTYPE html>

<link rel="manifest" href="/manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="Moja Aplikacija">
<link rel="apple-touch-icon" href="/icon-192.png">


<html lang="hr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: #fff9fb;
      --card: #ffffff;
      --ink: #2b2b2b;
      --muted:#6b6b6b;
      --brand:#e8a4c7; /* pastel pink */
      --brand-strong:#cf6fa5;
      --ring:#f5d4e5;
      --shadow: 0 10px 30px rgba(0,0,0,.08);
      --radius: 20px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif}
    img{max-width:100%;display:block}
    a{color:inherit;text-decoration:none}
    .container{width:min(1100px, 92vw);margin-inline:auto}
    .btn{appearance:none;border:none;background:var(--brand);color:#fff;padding:.9rem 1.2rem;border-radius:999px;font-weight:600;cursor:pointer;box-shadow:var(--shadow);transition:.2s}
    .btn:hover{transform:translateY(-2px);background:var(--brand-strong)}
    .btn-outline{background:#fff;color:var(--brand);border:2px solid var(--brand)}

    /* Nav */
    header{position:sticky;top:0;background:rgba(255,255,255,.75);backdrop-filter:blur(8px);z-index:20;border-bottom:1px solid #f2e6ee}
    .nav{display:flex;align-items:center;justify-content:space-between;padding:.8rem 0}
    .nav a{font-weight:600}
    .brand{display:flex;gap:.6rem;align-items:center}
    .logo{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,var(--brand),#ffd5e9)}

    /* Hero */
    .hero{display:grid;grid-template-columns:1.2fr .8fr;gap:2rem;align-items:center;padding:clamp(1rem, 4vw, 3rem) 0}
    .hero h1{font-family:"Playfair Display",serif;font-size:clamp(2rem,5vw,3.5rem);line-height:1.1;margin:.2rem 0}
    .hero p{color:var(--muted);max-width:52ch}
    .hero-card{background:var(--card);border-radius:var(--radius);padding:1rem;box-shadow:var(--shadow);overflow:hidden}
    .hero-img{height:380px;border-radius:16px;object-fit:cover}

    /* Sections */
    section{padding:3rem 0}
    .section-title{font-family:"Playfair Display",serif;font-size:2rem;margin:0 0 1.2rem}
    .muted{color:var(--muted)}

    /* About */
    .about{display:grid;grid-template-columns:1fr 1fr;gap:2rem}

    /* Services */
    .services{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1rem}
    .card{background:var(--card);border-radius:var(--radius);padding:1.2rem;box-shadow:var(--shadow);border:1px solid #f3e7ef}
    .price{font-weight:700}

    /* Gallery */
    .gallery{position:relative;border-radius:20px;overflow:hidden;box-shadow:var(--shadow)}
    .slider{position:relative;height:340px}
    .slide{position:absolute;inset:0;opacity:0;transition:opacity .6s ease}
    .slide.active{opacity:1}
    .slider-controls{position:absolute;inset:auto 0 10px 0;display:flex;justify-content:center;gap:.4rem}
    .dot{width:10px;height:10px;border-radius:50%;background:rgba(255,255,255,.6);border:1px solid #fff;cursor:pointer}
    .dot.active{background:#fff}

    /* Booking */
    .form{display:grid;grid-template-columns:1fr 1fr;gap:1rem}
    .form .full{grid-column:1/-1}
    label{font-size:.9rem;color:var(--muted)}
    input,select,textarea{width:100%;padding:.9rem;border-radius:14px;border:1.5px solid #efdfeb;background:#fff;outline:none}
    input:focus,select:focus,textarea:focus{box-shadow:0 0 0 4px var(--ring);border-color:var(--brand)}
    .notice{font-size:.85rem;color:var(--muted)}

    /* Admin */
    .admin{display:none}
    .admin.active{display:block}
    table{width:100%;border-collapse:collapse;background:#fff;border-radius:16px;overflow:hidden;box-shadow:var(--shadow)}
    th,td{padding:.8rem;border-bottom:1px solid #f1e8f0;text-align:left;font-size:.95rem}
    th{background:#fff5fa}

    /* Footer */
    footer{padding:2rem 0;border-top:1px solid #f2e6ee;color:var(--muted);font-size:.95rem}

    /* Responsive */
    @media (max-width: 880px){
      .hero{grid-template-columns:1fr;}
      .about{grid-template-columns:1fr;}
      .form{grid-template-columns:1fr}
    }
  </style>

</head>
<body>
  <header>
    <div class="container nav">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <a href="#top" aria-label="Beauty ST početna"><strong>Beauty ST</strong></a>
      </div>
      <nav style="display:flex;gap:1rem">
        <a href="#usluge">Usluge</a>
        <a href="#galerija">Galerija</a>
        <a href="#rezervacije" class="btn" style="padding:.5rem 1rem">Rezerviraj</a>
      </nav>
    </div>
  </header>

  <main id="top" class="container">
    <!-- Hero -->
    <section class="hero">
      <div>
        <h1>Beauty ST — Tvoj salon ljepote u Splitu</h1>
        <p>Prijateljska atmosfera, pažnja na detalje i usluge koje voliš. Rezerviraj termin online u nekoliko klikova.</p>
        <div style="display:flex;gap:.6rem;margin-top:1rem">
          <a class="btn" href="#rezervacije">Rezerviraj termin</a>
          <a class="btn btn-outline" href="#usluge">Pogledaj usluge</a>
        </div>
      </div>
      <div class="hero-card">
        <img class="hero-img" src="senka.jpg" alt="Salon interijer"/>
      </div>
    </section>

    <!-- O nama -->
    <section class="about" aria-labelledby="o-nama">
      <div>
        <h2 id="o-nama" class="section-title">O nama</h2>
        <p class="muted">Mi smo Beauty ST — tim zaljubljen u ljepotu i dobar dizajn. Naše usluge su jednostavne, transparentne i prilagođene tebi. Rezervacije su online, a potvrdu dobivaš odmah.</p>
      </div>
      <div class="card">
        <b> RADNO VRIJEME:</b>
        <br>pon,uto,sri: 12:00-20:00
        <br>čet, pet: 08:30-16:30<br>
        <b>LJETNO RADNO VRIJEME:</b>
        <br>pon-pet: 08:30-20:00
      </div>
    </section>

    <!-- Usluge / cjenik -->
    <section id="usluge" aria-labelledby="usluge-title">
      <h2 id="usluge-title" class="section-title">Usluge i cijene</h2>
      <div class="services">
        <article class="card"><h3>1.</h3><p class="muted">Trajanje: </p><p class="price">Cijena: €</p></article>
        <article class="card"><h3>2.</h3><p class="muted">Trajanje: </p><p class="price">Cijena: €</p></article>
        <article class="card"><h3>3.</h3><p class="muted">Trajanje: </p><p class="price">Cijena: €</p></article>
        <article class="card"><h3>4.</h3><p class="muted">Trajanje: </p><p class="price">Cijena: €</p></article>
      </div>
    </section>

    <!-- Galerija -->
    <section id="galerija" aria-labelledby="galerija-title">
      <h2 id="galerija-title" class="section-title">Galerija</h2>
      <div class="gallery">
        <div class="slider" id="slider">
          <!-- Slides injected by JS -->
        </div>
        <div class="slider-controls" id="slider-dots" aria-label="Kontrole galerije"></div>
      </div>
    </section>

    <!-- Rezervacije -->
    <section id="rezervacije" aria-labelledby="rez-title">
      <h2 id="rez-title" class="section-title">Rezervacija termina</h2>
      <p class="notice">Popuni podatke i potvrdi rezervaciju. Polja označena * su obavezna.</p>
      <form id="booking-form" class="form" autocomplete="on">
        <div>
          <label for="fullName">Ime i prezime *</label>
          <input id="fullName" name="fullName" required placeholder="Ana Anić" />
        </div>
        <div>
          <label for="contact">Kontakt (mobitel)</label>
          <input id="contact" name="contact" required placeholder="091 123 4567" />
        </div>
        <div>
          <label for="date">Datum *</label>
          <input id="date" name="date" type="date" required />
        </div>
        <div>
          <label for="email">Email *</label>
          <input type="email" id="email" name="email" required placeholder="ana.anic@email.com" />
        </div>

        <div>
          <label for="time">Termin *</label>
          <select id="time" name="time" required>
            <option value="">Odaberi termin…</option>

          </select>
        </div>
        <div class="full">
          <label for="service">Usluga *</label>
          <select id="service" name="service" required>
            <option value="">Odaberi uslugu…</option>
            <option value="manikura" data-duration="45">Klasična manikura (45 min)</option>
            <option value="frizura" data-duration="60">Frizura — feniranje (60 min)</option>
            <option value="masaza" data-duration="30">Masaža leđa (30 min)</option>
            <option value="lice" data-duration="50">Tretman lica (50 min)</option>
        </select>
        </div>
        <div class="full">
          <label for="note">Napomena (opcionalno)</label>
          <textarea id="note" name="note" rows="3" placeholder="Posebne želje ili info…"></textarea>
        </div>
        <div class="full" style="display:flex;gap:.8rem;align-items:center">
          <button class="btn" type="submit">Rezerviraj</button>
          <span id="form-status" class="muted" role="status" aria-live="polite"></span>
        </div>
      </form>
    </section>

    <!-- Admin (otvara se dodavanjem #admin u URL ili pritiskom tipke A 3x)-->
    <section id="admin" class="admin" aria-labelledby="admin-title">
      <h2 id="admin-title" class="section-title">Admin — Rezervacije</h2>
      <p class="notice">Ovdje se prikazuju rezervacije iz Firestore baze (kolekcija <code>reservations</code>).</p>
      <div style="overflow:auto">
        <table>
          <thead>
            <tr>
              <th>Vrijeme zapisa</th>
              <th>Ime</th>
              <th>Kontakt</th>
              <th>Email</th>
              <th>Datum</th>
              <th>Termin</th>
              <th>Usluga</th>
              <th>Napomena</th>
            </tr>
          </thead>
          <tbody id="admin-rows"></tbody>
        </table>
      </div>
    </section>
  </main>

  <footer>
    <div class="container" style="display:flex;justify-content:space-between;gap:1rem;flex-wrap:wrap">
      <div>© <span id="year"></span> Beauty ST</div>
      <div>
        <a href="mailto:info@beauty-st.example">info@beauty-st.example</a>
        · <a href="#" id="admin-link" title="Admin">Admin</a>
      </div>
    </div>
  </footer>

  <!-- Firebase + App logic -->
<script type="module">
  // ===== Gallery slider =====
  const slider = document.getElementById('slider');
  const dots = document.getElementById('slider-dots');
  const galleryImages = [
    'https://images.unsplash.com/photo-1519014816548-bf5fe059798b?q=80&w=1600&auto=format&fit=crop',
    'https://images.unsplash.com/photo-1512496015851-a90fb38ba796?q=80&w=1600&auto=format&fit=crop',
    'https://images.unsplash.com/photo-1508672019048-805c876b67e2?q=80&w=1600&auto=format&fit=crop'
  ];
  let slideIndex = 0;
  function renderSlides(){
    slider.innerHTML = galleryImages.map((src,i)=>`<img class="slide ${i===0?'active':''}" src="${src}" alt="Galerija ${i+1}"/>`).join('');
    dots.innerHTML = galleryImages.map((_,i)=>`<button class="dot ${i===0?'active':''}" aria-label="Prikaži sliku ${i+1}"></button>`).join('');
    [...dots.children].forEach((dot,i)=>dot.addEventListener('click',()=>setSlide(i)));
  }
  function setSlide(i){
    slideIndex = i;
    [...slider.children].forEach((el,idx)=>el.classList.toggle('active', idx===i));
    [...dots.children].forEach((el,idx)=>el.classList.toggle('active', idx===i));
  }
  function autoSlide(){ setSlide((slideIndex+1)%galleryImages.length); }
  renderSlides();
  setInterval(autoSlide, 4000);

  // ===== Helpers =====
  document.getElementById('year').textContent = new Date().getFullYear();
  const adminSection = document.getElementById('admin');
  const adminLink = document.getElementById('admin-link');
  function revealAdmin(){ adminSection.classList.add('active'); adminSection.scrollIntoView({behavior:'smooth'}); }
  if(location.hash==='#admin') revealAdmin();
  adminLink.addEventListener('click', e=>{ e.preventDefault(); revealAdmin(); });
  let aPress=0; window.addEventListener('keydown', e=>{ if(e.key.toLowerCase()==='a'){ aPress++; if(aPress>=3) revealAdmin(); setTimeout(()=>aPress=0,800);} });

  // ===== Firebase =====
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js';
  import { 
    getFirestore, collection, addDoc, serverTimestamp,
    getDocs, query, orderBy, where
  } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js';

  const firebaseConfig = {
    apiKey: "AIzaSyCwARNWwH3md8BioHdnCIxtexBj20L7lew",
    authDomain: "salon-73b4f.firebaseapp.com",
    projectId: "salon-73b4f",
    storageBucket: "salon-73b4f.firebasestorage.app",
    messagingSenderId: "166139048756",
    appId: "1:166139048756:web:e2327d15e8a61013852b61",
    measurementId: "G-WQYT55KL2Y"
  };

  let db=null;
  try{ db=getFirestore(initializeApp(firebaseConfig)); }
  catch(e){ console.warn('Firebase config nedostaje',e); }

  // ===== Radno vrijeme i slotovi =====
  const WORK = { start:"09:00", end:"17:00", interval:15 };

  function generateSlots(start=WORK.start, end=WORK.end, interval=WORK.interval){
    const slots=[];
    let [h,m]=start.split(":").map(Number);
    const [eh,em]=end.split(":").map(Number);
    while(h<eh || (h===eh && m<em)){
      slots.push(String(h).padStart(2,"0")+":"+String(m).padStart(2,"0"));
      m+=interval;
      if(m>=60){ m-=60; h++; }
    }
    return slots;
  }
  const allSlots = generateSlots();

  // ===== Vremenske pomoći =====
  function toMinutes(t){ const [h,m]=t.split(":").map(Number); return h*60+m; }
  function overlaps(start1, dur1, start2, dur2){
    const s1=toMinutes(start1), e1=s1+Number(dur1);
    const s2=toMinutes(start2), e2=s2+Number(dur2);
    return s1 < e2 && s2 < e1; // true ako se presijecaju (dodir = dopušten)
  }
  function endsWithinHours(start, duration){
    return toMinutes(start) + Number(duration) <= toMinutes(WORK.end);
  }

  // ===== Dohvat rezervacija i računanje slobodnih početaka =====
  async function getReservationsByDate(date){
    if(!db) return [];
    const qy=query(collection(db,"reservations"), where("date","==",date));
    const snap=await getDocs(qy);
    const list=[];
    snap.forEach(doc=>{
      const r=doc.data();
      list.push({ time:r.time, duration:Number(r.duration)||30 });
    });
    return list;
  }

  async function getAvailableStartTimes(date, duration){
    const dur = Number(duration);
    if(!date || !dur) return [];
    const existing = await getReservationsByDate(date);

    // kandidati su svi 15-minutni početci koji stanu u radno vrijeme
    return allSlots.filter(start=>{
      if(!endsWithinHours(start, dur)) return false;
      // ne smije se preklapati ni s jednom postojećom rezervacijom
      return !existing.some(r => overlaps(start, dur, r.time, r.duration));
    });
  }

  // ===== Booking form =====
  const form=document.getElementById('booking-form');
  const statusEl=document.getElementById('form-status');
  const dateInput=form.date;
  const timeSelect=form.time;
  const serviceSelect=form.service;

  async function refreshTimeOptions(){
    const date = dateInput.value;
    const opt = serviceSelect.selectedOptions[0];
    const duration = opt ? Number(opt.dataset.duration) : 0;

    timeSelect.innerHTML='<option value="">Učitavanje termina…</option>';
    timeSelect.disabled = true;

    if(!date || !duration){
      timeSelect.innerHTML='<option value="">Odaberi datum i uslugu…</option>';
      timeSelect.disabled = false;
      return;
    }

    const starts = await getAvailableStartTimes(date, duration);
    timeSelect.innerHTML = '<option value="">Odaberi termin…</option>';
    starts.forEach(s=>{
      const o=document.createElement('option'); o.value=s; o.textContent=s;
      timeSelect.appendChild(o);
    });
    if(starts.length===0){
      const o=document.createElement('option'); o.value=""; o.textContent="Nema slobodnih termina";
      timeSelect.appendChild(o);
    }
    timeSelect.disabled = false;

  }

  dateInput.addEventListener("change", refreshTimeOptions);
  serviceSelect.addEventListener("change", refreshTimeOptions);

  form.addEventListener('submit', async e=>{
    e.preventDefault();
    statusEl.textContent='Slanje…';

    const serviceOpt=serviceSelect.selectedOptions[0];
    const duration=Number(serviceOpt?.dataset.duration||0);

    const data={
      fullName: form.fullName.value.trim(),
      contact: form.contact.value.trim(),
      email: form.email.value.trim(),
      date: dateInput.value,
      time: timeSelect.value,
      service: serviceOpt?.value || "",
      duration: duration,
      note: form.note.value.trim(),
      createdAt: serverTimestamp()
    };

    if(!data.fullName||!data.contact||!data.date||!data.time||!data.service||!data.duration){
      statusEl.textContent='Molimo ispuni sva polja.'; 
      return;
    }

    try{
      if(!db) throw new Error('Nema veze s bazom');

      // Server-side provjera (protiv trke)
      const existing = await getReservationsByDate(data.date);
      const conflict = existing.some(r => overlaps(data.time, data.duration, r.time, r.duration));

      if(conflict){
        statusEl.textContent="Odabrani termin se u međuvremenu zauzeo. Odaberi drugi.";
        // osvježi listu termina da korisnik odmah vidi valjane
        await refreshTimeOptions();
        return;
      }

      await addDoc(collection(db,'reservations'),data);
      statusEl.textContent='Hvala! Termin je zaprimljen.';
      form.reset();
      timeSelect.innerHTML='<option value="">Odaberi datum i uslugu…</option>';
    }catch(err){
      console.error(err);
      statusEl.textContent='Greška pri spremanju.';
    }
  });

  // ===== Admin prikaz =====
  async function loadReservations(){
    if(!db) return;
    const qy=query(collection(db,'reservations'), orderBy('createdAt','desc'));
    const snap=await getDocs(qy);
    const tbody=document.getElementById('admin-rows');
    tbody.innerHTML='';
    snap.forEach(doc=>{
      const r=doc.data();
      const created=r.createdAt?.toDate?r.createdAt.toDate().toLocaleString():'—';
      const tr=document.createElement('tr');
      tr.innerHTML=`
        <td>${created}</td>
        <td>${r.fullName||''}</td>
        <td>${r.contact||''}</td>
        <td>${r.date||''}</td>
        <td>${r.time||''}</td>
        <td>${r.service||''} (${Number(r.duration)||30} min)</td>
        <td>${r.note||''}</td>`;
      tbody.appendChild(tr);
    });
  }
  const observer=new MutationObserver(()=>{ if(adminSection.classList.contains('active')) loadReservations(); });
  observer.observe(adminSection,{attributes:true});

  // ===== Service Worker =====
  if('serviceWorker' in navigator){
    navigator.serviceWorker.register('/sw.js').then(()=>console.log('SW registered'));
  }
</script>

</body>
</html>




